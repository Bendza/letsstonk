# Supabase Edge Functions Cron Configuration
# This file defines the cron schedule for automated functions

functions:
  rebalance:
    # Run daily at 3 AM UTC (0 3 * * *)
    # This timing avoids US market hours and high-traffic periods
    schedule: "0 3 * * *"
    
    # Environment variables for the function
    env:
      SOLANA_RPC_URL: ${SOLANA_RPC_URL}
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      JUP_API_KEY: ${JUP_API_KEY}
    
    # Function configuration
    timeout: 300 # 5 minutes timeout
    memory: 512 # 512MB memory allocation
    
    # Retry configuration
    retry:
      max_attempts: 3
      backoff_multiplier: 2
      initial_delay: 1000 # 1 second

  price-update:
    # Run every 5 minutes during market hours (9 AM - 4 PM EST, Mon-Fri)
    # Convert to UTC: 14:00-21:00 weekdays
    schedule: "*/5 14-21 * * 1-5"
    
    # Environment variables for the function
    env:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      JUP_API_KEY: ${JUP_API_KEY}
    
    # Function configuration
    timeout: 120 # 2 minutes timeout
    memory: 256 # 256MB memory allocation
    
    # Retry configuration
    retry:
      max_attempts: 2
      backoff_multiplier: 2
      initial_delay: 500 # 0.5 seconds

  portfolio-sync:
    # Run every hour during market hours to sync on-chain data
    schedule: "0 14-21 * * 1-5"
    
    # Environment variables for the function
    env:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      SOLANA_RPC_URL: ${SOLANA_RPC_URL}
      JUP_API_KEY: ${JUP_API_KEY}
    
    # Function configuration
    timeout: 180 # 3 minutes timeout
    memory: 512 # 512MB memory allocation
    
    # Retry configuration
    retry:
      max_attempts: 2
      backoff_multiplier: 2
      initial_delay: 1000 # 1 second

  risk-analysis:
    # Run risk analysis daily at 2 AM UTC (after rebalancing)
    schedule: "0 2 * * *"
    
    # Environment variables for the function
    env:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
    
    # Function configuration
    timeout: 300 # 5 minutes timeout
    memory: 256 # 256MB memory allocation
    
    # Retry configuration
    retry:
      max_attempts: 2
      backoff_multiplier: 2
      initial_delay: 1000 # 1 second
